<VirtualHost *:80>
  ServerName <%= @server_name %>
  <% if @server_alias -%>
  ServerAlias <%= @server_alias %>
  <% end -%>
  DocumentRoot <%= @docroot %>

  <Directory <%= @docroot %>>
    Options FollowSymLinks
    AllowOverride None
    Require all granted
  </Directory>

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  LogLevel info
  ErrorLog /var/log/apache2/<%= @name %>-error.log
  CustomLog /var/log/apache2/<%= @name %>-access.log combined

  <IfModule dir_module>
    DirectoryIndex index.php index.html
  </IfModule>
</VirtualHost>

<VirtualHost *:8000>
  ServerName <%= @server_name %>
  DocumentRoot <%= @docroot %>

  <Directory <%= @docroot %>>
    Options FollowSymLinks
    AllowOverride None
    Require all granted
  </Directory>

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  <IfModule dir_module>
    DirectoryIndex index.php index.html
  </IfModule>
</VirtualHost>

<IfModule mod_ssl.c>
  <VirtualHost _default_:443>
    ServerName <%= @server_name %>
    <% if @server_alias -%>
    ServerAlias <%= @server_alias %>
    <% end -%>
    DocumentRoot <%= @docroot %>

    <Directory <%= @docroot %>>
      Options FollowSymLinks
      AllowOverride None
      Require all granted
    </Directory>

    <Directory />
      Options FollowSymLinks
      AllowOverride None
    </Directory>

    LogLevel info
    ErrorLog /var/log/apache2/<%= @name %>-error.log
    CustomLog /var/log/apache2/<%= @name %>-access.log combined

    <IfModule dir_module>
      DirectoryIndex index.php index.html
    </IfModule>

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>
    <Directory /usr/lib/cgi-bin>
        SSLOptions +StdEnvVars
    </Directory>
    BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
    BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
  </VirtualHost>
</IfModule>
